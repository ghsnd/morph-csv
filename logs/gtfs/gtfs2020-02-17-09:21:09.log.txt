
QUERY: 1
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX gtfs: <http://vocab.gtfs.org/terms#>
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX dct: <http://purl.org/dc/terms/>

SELECT * WHERE {
	?shape a gtfs:Shape .
	?shape geo:lat ?shape_pt_lat .
	?shape geo:long ?shape_pt_lon .
	?shape gtfs:pointSequence ?shape_pt_sequence .
}
----------------------------------------------------
QUERY: 2
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX gtfs: <http://vocab.gtfs.org/terms#>
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX dct: <http://purl.org/dc/terms/>

SELECT * WHERE {
	?stop a gtfs:Stop . 
	OPTIONAL { ?stop dct:description ?stopDescription . }
	OPTIONAL { ?stop gtfs:wheelchairAccessible ?wheelchairAccesible }
	?stop geo:lat ?stopLat . 
	?stop geo:long ?stopLong .
	FILTER (?stopLat > 40.41) .		
}
csvColumns:
{"stops": {"source": "STOPS.csv", "columns": ["stop_id", "stop_desc", "wheelchair_boarding", "stop_lat", "stop_lon"]}
}


*****************************


CSV Format:
{"tmp/csv/STOPS.csv": ""stop_id","stop_desc","stop_lat","stop_lon","wheelchair_boarding"\n"acc_4_100_271","Avda de los Poblados 41","40.38582","-3.76105","0"\n"}

*****************************


SQL Schema:
DROP TABLE IF EXISTS "stops" CASCADE;
CREATE TABLE stops(stop_id VARCHAR,stop_desc VARCHAR,stop_lat DECIMAL(40,15),stop_lon DECIMAL(40,15),wheelchair_boarding INT);

----------------------------------------------------
QUERY: 3
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX gtfs: <http://vocab.gtfs.org/terms#>
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX gtfsstop: <http://transport.linkeddata.es/madrid/metro/stops/>

SELECT * WHERE {
	?stop a gtfs:Stop . 
        ?stop gtfs:locationType ?location .
	OPTIONAL { ?stop dct:description ?stopDescription . }

	OPTIONAL { 
		?stop geo:lat ?stopLat . 
		?stop geo:long ?stopLong .
	}
	OPTIONAL {?stop gtfs:wheelchairAccessible ?wheelchairAccessible .  }
	FILTER (?location=<http://transport.linkeddata.es/resource/LocationType/2>)
}
csvColumns:
{"stops": {"source": "STOPS.csv", "columns": ["location_type", "stop_id", "stop_lon", "wheelchair_boarding", "stop_lat", "stop_desc"]}
}


*****************************


CSV Format:
{"tmp/csv/STOPS.csv": ""stop_id","stop_desc","stop_lat","stop_lon","location_type","wheelchair_boarding"\n"acc_4_100_271","Avda de los Poblados 41","40.38582","-3.76105","2","0"\n"}

*****************************


SQL Schema:
DROP TABLE IF EXISTS "stops" CASCADE;
CREATE TABLE stops(stop_id VARCHAR,stop_desc VARCHAR,stop_lat DECIMAL(40,15),stop_lon DECIMAL(40,15),location_type INT,wheelchair_boarding INT);

----------------------------------------------------
QUERY: 4
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX gtfs: <http://vocab.gtfs.org/terms#>
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX dct: <http://purl.org/dc/terms/>

SELECT * WHERE {
	?route a gtfs:Route .
	OPTIONAL { ?route gtfs:shortName ?routeShortName . }
	OPTIONAL { ?route gtfs:longName ?routeLongName . } 
	OPTIONAL { ?route dct:description ?routeDescription . } 
	?route gtfs:agency ?agency .

	?agency a gtfs:Agency .
	?agency foaf:page ?agencyPage .
	?agency foaf:name ?agencyName .
	OPTIONAL { ?agency foaf:phone ?agencyPhone . }
}
csvColumns:
{"agency": {"source": "AGENCY.csv", "columns": ["agency_id", "agency_name", "agency_phone", "agency_url"]}
, "routes": {"source": "ROUTES.csv", "columns": ["route_id", "agency_id", "route_desc", "route_long_name", "route_short_name"]}
}


*****************************


CSV Format:
{"tmp/csv/AGENCY.csv": ""agency_id","agency_name","agency_url","agency_phone"\n"CRTM","Consorcio Regional de Transportes de Madrid","http://www.crtm.es",""\n", "tmp/csv/ROUTES.csv": ""route_id","agency_id","route_short_name","route_long_name","route_desc"\n"4__10___","CRTM","10","Hospital del Norte-Puerta del Sur",""\n"}

*****************************


SQL Schema:
DROP TABLE IF EXISTS "agency" CASCADE;
CREATE TABLE agency(agency_id VARCHAR,agency_name VARCHAR,agency_url VARCHAR,agency_phone VARCHAR,PRIMARY KEY (agency_id));
DROP TABLE IF EXISTS "routes" CASCADE;
CREATE TABLE routes(route_id VARCHAR,agency_id VARCHAR,route_short_name VARCHAR,route_long_name VARCHAR,route_desc VARCHAR,PRIMARY KEY (route_id));

----------------------------------------------------
QUERY: 5
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX gtfs: <http://vocab.gtfs.org/terms#>
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX schema: <http://schema.org/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

SELECT * WHERE {
	?service a gtfs:Service .

	?service gtfs:serviceRule ?serviceRule .
        
	?serviceRule a gtfs:CalendarDateRule .
	?serviceRule dct:date ?date .
	?serviceRule gtfs:dateAddition "true"^^xsd:boolean .
	FILTER(?date > "2016-06-01"^^xsd:date)
}
----------------------------------------------------
QUERY: 6
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX gtfs: <http://vocab.gtfs.org/terms#>
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX gtfsagency: <http://transport.linkeddata.es/madrid/agency/>

SELECT (count(?route) as ?nRoutes) WHERE {
	?route a gtfs:Route .
	?route gtfs:agency ?agency .
	FILTER (?agency=gtfsagency:CRTM)
}
csvColumns:
{"routes": {"source": "ROUTES.csv", "columns": ["route_id", "agency_id"]}
, "agency": {"source": "AGENCY.csv", "columns": ["agency_id"]}
}


*****************************


CSV Format:
{"tmp/csv/ROUTES.csv": ""route_id","agency_id"\n"4__10___","CRTM"\n", "tmp/csv/AGENCY.csv": ""agency_id"\n"CRTM"\n"}

*****************************


SQL Schema:
DROP TABLE IF EXISTS "agency" CASCADE;
CREATE TABLE agency(agency_id VARCHAR,PRIMARY KEY (agency_id));
DROP TABLE IF EXISTS "routes" CASCADE;
CREATE TABLE routes(route_id VARCHAR,agency_id VARCHAR,PRIMARY KEY (route_id));

----------------------------------------------------
QUERY: 7
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX gtfs: <http://vocab.gtfs.org/terms#>
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX gtfsroute: <http://transport.linkeddata.es/madrid/metro/routes/>
PREFIX gtfsaccessible: <http://transport.linkeddata.es/resource/WheelchairBoardingStatus/>

SELECT DISTINCT ?routeShortName ?routeDescription ?tripShortName ?stopDescription ?stopLat ?stopLong   WHERE {
	?route a gtfs:Route .
	OPTIONAL { ?route gtfs:shortName ?routeShortName . }
	OPTIONAL { ?route dct:description ?routeDescription . }

	?trip a gtfs:Trip .
	OPTIONAL { ?trip gtfs:shortName ?tripShortName . }
	?trip gtfs:service ?service .
	?trip gtfs:route ?route .

	?stopTime a gtfs:StopTime . 
	?stopTime gtfs:trip ?trip . 
	?stopTime gtfs:stop ?stop . 

	?stop a gtfs:Stop . 
	OPTIONAL { ?stop dct:description ?stopDescription . }
	OPTIONAL {
		?stop geo:lat ?stopLat . 
		?stop geo:long ?stopLong . 
	}
	?stop gtfs:wheelchairAccessible gtfsaccessible:1 .
	FILTER (?route=gtfsroute:4__1___)
}----------------------------------------------------
QUERY: 8
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX gtfs: <http://vocab.gtfs.org/terms#>
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX gtfsstop: <http://transport.linkeddata.es/madrid/metro/stops/>

SELECT * WHERE {
	?route a gtfs:Route .
	OPTIONAL { ?route gtfs:shortName ?routeShortName . }
	OPTIONAL { ?route dct:description ?routeDescription . }

	?trip a gtfs:Trip .
	OPTIONAL { ?trip gtfs:shortName ?tripShortName . }
	?trip gtfs:service ?service .
	?trip gtfs:route ?route .

	?stopTime a gtfs:StopTime . 
	?stopTime gtfs:trip ?trip . 
	?stopTime gtfs:stop ?stop . 

	?stop a gtfs:Stop . 
	OPTIONAL {?stop dct:description ?stopDescription . }

	?service a gtfs:Service .
	?service gtfs:serviceRule ?serviceRule .
}

csvColumns:
{"trips": {"columns": ["trip_id", "service_id", "trip_short_name", "route_id"], "source": "TRIPS.csv"}
, "services1": {"columns": ["service_id"], "source": "CALENDAR.csv"}
, "calendar_date_rules": {"columns": ["service_id"], "source": "CALENDAR_DATES.csv"}
, "calendar_rules": {"columns": ["service_id"], "source": "CALENDAR.csv"}
, "stoptimes": {"columns": ["trip_id", "arrival_time", "stop_id"], "source": "STOP_TIMES.csv"}
, "routes": {"columns": ["route_id", "route_short_name", "route_desc"], "source": "ROUTES.csv"}
, "services2": {"columns": ["service_id"], "source": "CALENDAR_DATES.csv"}
, "stops": {"columns": ["stop_desc", "stop_id"], "source": "STOPS.csv"}
}


*****************************


CSV Format:
{"tmp/csv/CALENDAR_DATES.csv": ""service_id"\n"4_I12"\n", "tmp/csv/TRIPS.csv": ""route_id","service_id","trip_id","trip_short_name"\n"4__10___","4_I12","4_I12-101_2016I12_1_1_4__10_A__","Hospital del Norte - Puerta del Sur"\n", "tmp/csv/STOPS.csv": ""stop_id","stop_desc"\n"acc_4_100_271","Avda de los Poblados 41"\n", "tmp/csv/CALENDAR.csv": ""service_id"\n"4_I12"\n", "tmp/csv/STOP_TIMES.csv": ""trip_id","arrival_time","stop_id"\n"4_I12-001_2016I12_1_1_4__1___","00:00:00","par_4_263"\n", "tmp/csv/ROUTES.csv": ""route_id","route_short_name","route_desc"\n"4__10___","10",""\n"}

*****************************


SQL Schema:
DROP TABLE IF EXISTS "calendar" CASCADE;
CREATE TABLE calendar(service_id VARCHAR,PRIMARY KEY (service_id));
DROP TABLE IF EXISTS "calendar_dates" CASCADE;
CREATE TABLE calendar_dates(service_id VARCHAR,PRIMARY KEY (service_id));
DROP TABLE IF EXISTS "routes" CASCADE;
CREATE TABLE routes(route_id VARCHAR,route_short_name VARCHAR,route_desc VARCHAR,PRIMARY KEY (route_id));
DROP TABLE IF EXISTS "stop_times" CASCADE;
CREATE TABLE stop_times(trip_id VARCHAR,arrival_time VARCHAR,stop_id VARCHAR,PRIMARY KEY (trip_id,arrival_time,stop_id));
DROP TABLE IF EXISTS "stops" CASCADE;
CREATE TABLE stops(stop_id VARCHAR,stop_desc VARCHAR,PRIMARY KEY (stop_id));
DROP TABLE IF EXISTS "trips" CASCADE;
CREATE TABLE trips(route_id VARCHAR,service_id VARCHAR,trip_id VARCHAR,trip_short_name VARCHAR,PRIMARY KEY (trip_id));

----------------------------------------------------
QUERY: 9
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX gtfs: <http://vocab.gtfs.org/terms#>
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX gtfsstop: <http://transport.linkeddata.es/madrid/metro/stops/>

SELECT * WHERE {
	?trip a gtfs:Trip .
	OPTIONAL { ?trip gtfs:shortName ?tripShortName . }
	?trip gtfs:service ?service .
	?trip gtfs:route ?route .
	?trip gtfs:shape ?shape .

	?shape a gtfs:Shape .
	?shape geo:lat ?lat .
	FILTER (?lat > 40.40)
}
----------------------------------------------------
QUERY: 10
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX gtfs: <http://vocab.gtfs.org/terms#>
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX dct: <http://purl.org/dc/terms/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX gtfsroute: <http://transport.linkeddata.es/madrid/metro/routes/>

SELECT (count(distinct ?trip) as ?count)  WHERE {
	?trip a gtfs:Trip .

	?stopTime a gtfs:StopTime . 
	?stopTime gtfs:trip ?trip . 
	?stopTime gtfs:departureTime ?departureTime .

	FILTER (?departureTime >= "00:30:00"^^xsd:duration) .
}
